
/* Kelompok 4 - Program Pelayanan RS - Medicare X
 Vonaquie Jojor
 Safwatun Naila
 Farah Dhiba
 Indah Febeyola
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_PATIENTS 200
#define NAME_LEN 100
#define PHONE_LEN 32
#define RUJUK_LEN 100
#define DIAG_LEN 256
#define HISTORY_LEN 1024
#define IDNO_LEN 32

/* tipe pembayaran */
typedef enum { PAY_MANDIRI = 0, PAY_BPJS = 1 } PayType;
/* stage sederhana */
typedef enum { ST_REG=0, ST_POLI_DONE=1, ST_APOTEK_DONE=2, ST_TEST_DONE=3, ST_INROOM=4, ST_DISCHARGED=5 } Stage;

/* struktur pasien (ditambahkan field id_no untuk NIK/No.Identitas) */
typedef struct {
    unsigned long id;
    int queue_no;
    char name[NAME_LEN];
    int age;
    char phone[PHONE_LEN];
    char id_no[IDNO_LEN];       /* NIK / No.Identitas (sesuai rancangan) */
    int is_rujuk; /* 0/1 */
    char rujukan_from[RUJUK_LEN];
    char rujukan_no[32];
    char diagnosis_awal[DIAG_LEN];
    PayType paytype;
    char pay_no[64];
    char history[HISTORY_LEN];
    Stage stage;
} Patient;

/* database sederhana */
Patient patients[MAX_PATIENTS];
int patient_count = 0;
unsigned long next_id = 1;
int next_queue = 1;

/* prototypes untuk fungsi yang dipanggil sebelum definisi */
void apotek_process_for_patient(Patient *p);
void kamar_langsung(Patient *p);
void tampilkanRincian(const Patient *p);
void append_history(Patient *p, const char *txt);
void formatRibuan(int nilai, char *out, int outsz);

/* Validasi login pegawai */
int is_valid_worker(const char *user, const char *pass) {
    if ((strcmp(user, "vonaquie") == 0 && strcmp(pass, "251712034") == 0) ||
        (strcmp(user, "safwatun") == 0 && strcmp(pass, "251712027") == 0) ||
        (strcmp(user, "farah") == 0 && strcmp(pass, "251712038") == 0) ||
        (strcmp(user, "indah") == 0 && strcmp(pass, "251712030") == 0)) {
        return 1;
    }
    return 0;
}

/* helper input */
void read_line(char *buf, int size) {
    if (fgets(buf, size, stdin) == NULL) {
        buf[0] = '\0';
        return;
    }
    buf[strcspn(buf, "\n")] = '\0';
}

/* append history */
void append_history(Patient *p, const char *txt) {
    if (!p || !txt || txt[0] == '\0') return;
    if (p->history[0] == '\0') {
        strncpy(p->history, txt, HISTORY_LEN-1);
        p->history[HISTORY_LEN-1] = '\0';
    } else {
        strncat(p->history, "\n", HISTORY_LEN - strlen(p->history) - 1);
        strncat(p->history, txt, HISTORY_LEN - strlen(p->history) - 1);
    }
}

/* format ribuan (Indonesia) */
void formatRibuan(int nilai, char *out, int outsz) {
    char tmp[64];
    int idx = 0;
    int n = nilai;
    if (n == 0) {
        strncpy(out, "0", outsz-1);
        out[outsz-1] = '\0';
        return;
    }
    int count = 0;
    while (n > 0 && idx < (int)sizeof(tmp)-1) {
        if (count == 3) {
            tmp[idx++] = '.';
            count = 0;
        }
        tmp[idx++] = '0' + (n % 10);
        n /= 10;
        count++;
    }
    int j = 0;
    if (idx >= outsz) idx = outsz - 1;
    while (idx > 0 && j < outsz - 1) {
        out[j++] = tmp[--idx];
    }
    out[j] = '\0';
}

//Status Layanan
const char* stage_name(Stage s) {
    switch (s) {
        case ST_REG: return "Terdaftar (Pendaftaran)";
        case ST_POLI_DONE: return "Sudah ke POLI";
        case ST_APOTEK_DONE: return "Sudah ke Apotek";
        case ST_TEST_DONE: return "Sudah Tes/Cek";
        case ST_INROOM: return "Rawat Inap / Di Kamar";
        case ST_DISCHARGED: return "Pulang / Dirujuk";
        default: return "Unknown";
    }
}

// tampilkan rincian pasien
void tampilkanRincian(const Patient *p) {
    if (!p) return;
    printf("\n---- Pasien ID %lu ----\n", p->id);
    printf("Nama    : %s\n", p->name);
    printf("Umur    : %d\n", p->age);
    printf("Telp    : %s\n", p->phone);
    printf("NIK/ID  : %s\n", p->id_no[0] ? p->id_no : "(tidak ada)");
    if (p->is_rujuk) {
        printf("\nRujukan : Dari %s | No: %s\n", p->rujukan_from, p->rujukan_no);
        printf("Dx awal : %s\n", p->diagnosis_awal);
    }
    printf("\nPembayaran : %s | No: %s\n", p->paytype == PAY_BPJS ? "BPJS" : "Mandiri", p->pay_no);
    printf("\nStage : %s\n", stage_name(p->stage));
    printf("\nRiwayat:\n%s\n", p->history[0] ? p->history : "(kosong)");
}

// cari pasien
Patient* find_by_queue(int q) {
    for (int i = 0; i < patient_count; ++i) {
        if (patients[i].queue_no == q) return &patients[i];
    }
    return NULL;
}
Patient* find_by_id(unsigned long id) {
    for (int i = 0; i < patient_count; ++i) {
        if (patients[i].id == id) return &patients[i];
    }
    return NULL;
}

// registrasi pasien (menambahkan input NIK/No.Identitas sesuai rancangan)
void register_patient() {
    if (patient_count >= MAX_PATIENTS) {
        printf("Penuh: tidak bisa menambah pasien lagi.\n");
        return;
    }
    Patient tmp;
    tmp.id = next_id++;
    tmp.queue_no = next_queue++;
    tmp.age = 0;
    tmp.phone[0] = '\0';
    tmp.id_no[0] = '\0';
    tmp.is_rujuk = 0;
    tmp.rujukan_from[0] = '\0';
    tmp.rujukan_no[0] = '\0';
    tmp.diagnosis_awal[0] = '\0';
    tmp.pay_no[0] = '\0';
    tmp.history[0] = '\0';
    tmp.stage = ST_REG;

    char buf[256];

    printf("\n===--- 01 PENDAFTARAN ---===\n");
    printf("Nama: ");
    read_line(tmp.name, NAME_LEN);
    if (tmp.name[0] == '\0') { printf("Nama kosong. Batal.\n"); return; }

    while (1) {
        printf("Umur: ");
        read_line(buf, sizeof(buf));
        if (sscanf(buf, "%d", &tmp.age) == 1 && tmp.age >= 0) break;
        printf("Umur tidak valid. Masukkan angka >= 0.\n");
    }

    printf("NIK / No. Identitas: ");
    read_line(tmp.id_no, IDNO_LEN);

    printf("Telepon: ");
    read_line(tmp.phone, PHONE_LEN);

    printf("Apakah pasien rujukan dari RS lain? (y/n): ");
    read_line(buf, sizeof(buf));
    if (buf[0] == 'y' || buf[0] == 'Y') {
        tmp.is_rujuk = 1;
        printf("Asal rumah sakit: ");
        read_line(tmp.rujukan_from, RUJUK_LEN);
        while (1) {
            printf("No rujukan (7 digit Mandiri / 10 digit BPJS): ");
            read_line(tmp.rujukan_no, sizeof(tmp.rujukan_no));
            size_t ln = strlen(tmp.rujukan_no);
            if (ln == 7 || ln == 10) break;
            printf("No rujukan harus 7 atau 10 digit. Saat ini: %zu\n", ln);
        }
        printf("Diagnosis awal: ");
        read_line(tmp.diagnosis_awal, DIAG_LEN);

        char t[512];
        snprintf(t, sizeof(t), "Rujukan dari %s | No:%s | Dx:%s",
                 tmp.rujukan_from[0] ? tmp.rujukan_from : "-",
                 tmp.rujukan_no[0] ? tmp.rujukan_no : "-",
                 tmp.diagnosis_awal[0] ? tmp.diagnosis_awal : "-");
        append_history(&tmp, t);
    }

    //Pembayaran
    while (1) {
        printf("Pembayaran: 1=Mandiri  2=BPJS : ");
        read_line(buf, sizeof(buf));
        int p = atoi(buf);
        if (p == 2) {
            tmp.paytype = PAY_BPJS;
            while (1) {
                printf("Masukkan nomor BPJS (10 digit): ");
                read_line(tmp.pay_no, sizeof(tmp.pay_no));
                if (strlen(tmp.pay_no) == 10) break;
                printf("Nomor BPJS harus 10 digit.\n");
            }
            break;
        } else if (p == 1) {
            tmp.paytype = PAY_MANDIRI;
            while (1) {
                printf("Masukkan kode/nomor deposit (disarankan 7 digit): ");
                read_line(tmp.pay_no, sizeof(tmp.pay_no));
                if (strlen(tmp.pay_no) >= 1) break;
                printf("Masukkan minimal 1 karakter.\n");
            }
            break;
        } else {
            printf("Pilihan tidak valid.\n");
        }
    }

    {
        char base[256];
        snprintf(base, sizeof(base), "Terdaftar: ID=%lu Antrian=%d Pembayaran=%s No:%s",
                 tmp.id, tmp.queue_no, tmp.paytype==PAY_BPJS?"BPJS":"Mandiri", tmp.pay_no);
        append_history(&tmp, base);
    }

    patients[patient_count++] = tmp;
    printf("Terdaftar: ID=%lu | NoAntrian=%d\n", tmp.id, tmp.queue_no);
}

/* Fungsi khusus: proses apotek untuk pasien yang sudah didapatkan pointernya
   (dipanggil otomatis dari poli_doctor bila dokter memilih rawat jalan) */
void apotek_process_for_patient(Patient *p) {
    if (!p) return;
    char buf[256];

    printf("\n=== APOTEK (langsung untuk pasien ID %lu) ===\n", p->id);
    printf("Tampilkan rincian singkat:\n");
    tampilkanRincian(p);

    printf("Masukkan resep / aturan pakai: ");
    read_line(buf, sizeof(buf));
    if (buf[0]) {
        char note[300];
        snprintf(note, sizeof(note), "Resep/Aturan: %s", buf);
        append_history(p, note);
    }

    int biaya_obat = 25000;
    char biaya_str[64];
    formatRibuan(biaya_obat, biaya_str, sizeof(biaya_str));
    printf("Biaya obat = Rp. %s\n", biaya_str);

    printf("Pembayaran lunas? (y/n): ");
    read_line(buf, sizeof(buf));
    if (!(buf[0]=='y' || buf[0]=='Y')) {
        append_history(p, "Apotek: pembayaran obat belum lunas.");
        printf("Pembayaran obat belum lunas. Ambil obat dihentikan.\n");
        return;
    }

    append_history(p, "Obat diambil di apotek.");
    p->stage = ST_APOTEK_DONE;
    printf("Selesai proses apotek untuk pasien ID %lu\n", p->id);
}

/* fungsi kamar langsung (dapat dipanggil dari poli_doctor) */
void kamar_langsung(Patient *p) {
    if (!p) return;
    printf("\n=== 05 Kamar (langsung) ===\n");
    tampilkanRincian(p);

    char buf[32];
    printf("1 = Check-in\n2 = Check-out\nPilih: ");
    read_line(buf, sizeof(buf));
    int ch = atoi(buf);

    if (ch == 1) {
        append_history(p, "Masuk kamar (check-in).");
        p->stage = ST_INROOM;
        printf("Pasien check-in.\n");
    } else if (ch == 2) {
        append_history(p, "Keluar kamar (check-out).");
        p->stage = ST_DISCHARGED;
        printf("Pasien check-out.\n");
    } else {
        printf("Pilihan tidak valid.\n");
    }
}

/* POLI/Dokter (memanggil apotek_process_for_patient / kamar_langsung bila perlu) */
void poli_doctor() {
    char buf[256];
    printf("\n=== 02 POLI/Dokter ===\nMasukkan nomor antrian pasien (0 batal): ");
    read_line(buf, sizeof(buf));
    int q = atoi(buf);
    if (q == 0) return;

    Patient *p = find_by_queue(q);
    if (!p) {
        printf("Nomor antrian %d tidak ditemukan.\n", q);
        return;
    }

    tampilkanRincian(p);
    printf("Hasil pemeriksaan (satu baris): ");
    read_line(buf, sizeof(buf));
    if (buf[0]) append_history(p, buf);

    printf("\n\n1=Rawat Jalan (obat)\n2=Rawat Inap\n3=Operasi (rawat inap)\n4=Rujuk ke RS lain\nPilih Keputusan dokter: ");
    read_line(buf, sizeof(buf));
    int k = atoi(buf);

    if (k == 1) {
        append_history(p, "Keputusan: Rawat jalan (resep obat).");
        int biaya = 50000;
        char biaya_str[64];
        formatRibuan(biaya, biaya_str, sizeof(biaya_str));
        printf("Biaya pelayanan (poli + resep) = Rp. %s\n", biaya_str);

        printf("Pembayaran lunas? (y/n): ");
        read_line(buf, sizeof(buf));
        if (!(buf[0]=='y' || buf[0]=='Y')) {
            append_history(p, "Pembayaran POLI belum lunas.");
            printf("Pembayaran belum lunas. Proses ditunda.\n");
            return;
        }

        append_history(p, "Pembayaran POLI lunas.");
        p->stage = ST_POLI_DONE;
        printf("Pasien diarahkan ke Apotek.\n");

        /* langsung proses apotek otomatis untuk pasien ini */
        apotek_process_for_patient(p);
        return;
    }
    else if (k == 2) {
        append_history(p, "Keputusan: Rawat inap (masuk kamar).");
        p->stage = ST_INROOM;
        printf("Pasien perlu rawat inap. Mengarahkan ke kamar...\n");

        /* langsung check-in kamar untuk pasien ini */
        kamar_langsung(p);
        return;
    }
    else if (k == 3) {
        append_history(p, "Keputusan: Operasi (rawat inap).");
        p->stage = ST_INROOM;
        printf("Operasi: lanjut ke kamar...\n");

        /* ke kamar untuk persiapan operasi */
        kamar_langsung(p);
        append_history(p, "Operasi: catatan persiapan operasi ditambahkan.");
        return;
    }
    else if (k == 4) {
        append_history(p, "Keputusan: Rujuk ke RS lain.");
        p->stage = ST_DISCHARGED;
        if (p->paytype == PAY_MANDIRI) {
            append_history(p, "Rujuk: keluarkan nomor 7 digit (Mandiri).");
            printf("Output nomor rujukan (gunakan No Pembayaran/ID): %s\n", p->pay_no);
        } else {
            append_history(p, "Rujuk: keluarkan nomor 10 digit (BPJS).");
            printf("Output nomor rujukan (BPJS): %s\n", p->pay_no);
        }
        return;
    }
    else {
        printf("Pilihan tidak valid.\n");
        return;
    }
}

/* Apotek (manual via menu utama) */
void apotek() {
    char buf[256];
    printf("\n=== 03 Apotek ===\nMasukkan nomor antrian pasien (0 batal): ");
    read_line(buf, sizeof(buf));
    int q = atoi(buf);
    if (q == 0) return;
    Patient *p = find_by_queue(q);
    if (!p) { printf("Nomor antrian %d tidak ditemukan.\n", q); return; }
    if (p->stage < ST_POLI_DONE) { printf("Pasien belum mendapat resep dari dokter.\n"); return; }

    printf("Masukkan resep / aturan pakai: ");
    read_line(buf, sizeof(buf));
    if (buf[0]) append_history(p, buf);

    int biaya_obat = 25000;
    char biaya_str[64];
    formatRibuan(biaya_obat, biaya_str, sizeof(biaya_str));
    printf("Biaya obat = Rp. %s\n", biaya_str);
    printf("Pembayaran lunas? (y/n): ");
    read_line(buf, sizeof(buf));
    if (!(buf[0]=='y' || buf[0]=='Y')) {
        append_history(p, "Pembayaran apotek belum lunas.");
        printf("Pembayaran obat belum lunas. Proses dihentikan.\n");
        return;
    }
    append_history(p, "Obat diambil di apotek.");
    p->stage = ST_APOTEK_DONE;
    printf("Selesai proses apotek untuk pasien ID %lu\n", p->id);
}

/* Fungsi Tes (01/02) sesuai rancangan:
   01 = Tes Narkoba (Rp100.000)
   02 = Cek Kesehatan (Rp200.000)
   Hanya untuk Mandiri; cek pembayaran, input kondisi, cetak surat persis format rancangan
*/
void perform_test_choice(int type) {
    char buf[512];
    printf("\nMasukkan nomor antrian pasien (0 batal): ");
    read_line(buf, sizeof(buf));
    int q = atoi(buf);
    if (q == 0) return;
    Patient *p = find_by_queue(q);
    if (!p) { printf("Nomor antrian %d tidak ditemukan.\n", q); return; }

    if (p->paytype != PAY_MANDIRI) {
        printf("Tindakan ini hanya untuk pasien Pembayaran Mandiri. (BPJS tidak diizinkan)\n");
        append_history(p, "Tes ditolak: pasien BPJS untuk tindakan ini.");
        return;
    }

    int biaya = (type == 1) ? 100000 : 200000;
    const char *judul = (type == 1) ? "Tes Narkoba" : "Cek Kesehatan";
    char biaya_str[64];
    formatRibuan(biaya, biaya_str, sizeof(biaya_str));

    printf("\n--- %s ---\n", judul);
    printf("Biaya: Rp. %s\n", biaya_str);
    printf("Pembayaran lunas? (y/n): ");
    read_line(buf, sizeof(buf));
    if (!(buf[0]=='y' || buf[0]=='Y')) {
        char t[256];
        snprintf(t, sizeof(t), "%s: pembayaran belum lunas.", judul);
        append_history(p, t);
        printf("Pembayaran belum lunas. Proses dibatalkan.\n");
        return;
    }

    /* input kondisi / hasil */
    char hasil[512];
    printf("Masukkan kondisi/hasil pemeriksaan (satu baris): ");
    read_line(hasil, sizeof(hasil));
    if (hasil[0] == '\0') strcpy(hasil, "(tidak diisi)");
    printf("\n\n");

    /* simpan riwayat */
    char hist[768];
    snprintf(hist, sizeof(hist), "%s hasil: %s | biaya Rp.%s | pembayaran lunas", judul, hasil, biaya_str);
    append_history(p, hist);
    p->stage = ST_TEST_DONE;

    /* Cetak surat sesuai format rancangan (header + fields)
       Format disesuaikan persis: Judul Surat (sesuai jenis), Nama, Umur, NIK/No Identitas, Hasil
    */
    if (type == 2) {
        printf("\n--- SURAT KETERANGAN HASIL CEK KESEHATAN ---\n");
    } else {
        printf("\n--- SURAT KETERANGAN HASIL TES NARKOBA ---\n");
    }
    printf("Nama                : %s\n", p->name);
    printf("Umur                : %d\n", p->age);
    printf("NIK / No Identitas  : %s\n", p->id_no[0] ? p->id_no : "(tidak ada)");
    printf("Nomor telepon       : %s\n", p->phone);
    printf("Hasil               : %s\n", hasil);
    printf("---------- End of Surat ----------\n");

    printf("\n\nTindakan %s selesai untuk pasien ID %lu\n", judul, p->id);
}

/* Kamar (manual via menu utama) */
void kamar() {
    char buf[256];
    printf("\n=== 05 Kamar ===\nMasukkan ID pasien (0 batal): ");
    read_line(buf, sizeof(buf));
    unsigned long id = strtoul(buf, NULL, 10);
    if (id == 0) return;
    Patient *p = find_by_id(id);
    if (!p) { printf("Pasien ID %lu tidak ditemukan.\n", id); return; }
    tampilkanRincian(p);

    printf("1=Check-in (masuk kamar)\n2=Check-out (pulang)\nPilih: ");
    read_line(buf, sizeof(buf));
    int ch = atoi(buf);
    if (ch == 1) {
        append_history(p, "Masuk kamar / dirawat (check-in).");
        p->stage = ST_INROOM;
        printf("Pasien check-in.\n");
    } else if (ch == 2) {
        append_history(p, "Keluar / pulang (check-out).");
        p->stage = ST_DISCHARGED;
        printf("Pasien dipulangkan.\n");
    } else {
        printf("Batal.\n");
    }
}

/* list / search */
void list_patients() {
    if (patient_count == 0) { printf("Belum ada pasien terdaftar.\n"); return; }
    printf("\n=== Daftar Pasien ===\n");
    for (int i = 0; i < patient_count; ++i) {
        printf("[%d] ID:%lu Q:%d Name:%s | Stage:%s\n", i+1, patients[i].id, patients[i].queue_no, patients[i].name, stage_name(patients[i].stage));
    }
}
void search_name() {
    char q[NAME_LEN];
    printf("Masukkan nama/substring: ");
    read_line(q, sizeof(q));
    int found = 0;
    for (int i = 0; i < patient_count; ++i) {
        if (q[0] == '\0' || strstr(patients[i].name, q)) {
            tampilkanRincian(&patients[i]);
            found = 1;
        }
    }
    if (!found) printf("Tidak ditemukan pasien dengan nama tersebut.\n");
}

/* kecil setelah apotek/kamar */
void post_action_menu_after_apotek_or_kamar() {
    char buf[32];
    printf("\nSetelah tindakan, pilih:\n1: list_patients()\n2: search_name()\n3: simpan (demo)\nPilih: ");
    read_line(buf, sizeof(buf));
    int x = atoi(buf);
    if (x == 1) list_patients();
    else if (x == 2) search_name();
    else if (x == 3) printf("Simpan: (demo) -- fitur dapat ditambahkan nanti.\n");
    else printf("Pilihan tidak valid.\n");
}

/* tindakan_menu sesuai rancangan: hanya 02 (Poli) dan 04 (Tes) dengan prompt Pilih 02/04.
   Submenu Tes meminta Pilih 01/02 sesuai rancangan. */
void tindakan_menu() {
    char buf[32];
    while (1) {
        printf("\nTindakan yang dipilih:\n");
        printf("02: POLI/Dokter\n");
        printf("04: Tes / Cek\n");
        printf("0: Kembali\n");
        printf("Pilih 02/04: ");
        read_line(buf, sizeof(buf));
        if (strcmp(buf, "0") == 0) return;
        if (strcmp(buf, "02") == 0 || strcmp(buf, "2") == 0) {
            poli_doctor();
        } else if (strcmp(buf, "04") == 0 || strcmp(buf, "4") == 0) {
            printf("\nSubmenu Tes:\n");
            printf("01: Tes Narkoba (Rp100.000)\n");
            printf("02: Cek Kesehatan (Rp200.000)\n");
            printf("0: Batal\n");
            printf("Pilih 01/02: ");
            read_line(buf, sizeof(buf));
            if (strcmp(buf, "0") == 0) continue;
            if (strcmp(buf, "01") == 0 || strcmp(buf, "1") == 0) {
                perform_test_choice(1);
            } else if (strcmp(buf, "02") == 0 || strcmp(buf, "2") == 0) {
                perform_test_choice(2);
            } else {
                printf("Pilihan tidak valid.\n");
            }
        } else {
            printf("Pilihan tidak valid. Masukkan 02 atau 04.\n");
        }
    }
}

/* login sederhana */
int login() {
    char user[32], pass[32];
    int attempts = 3;
    while (attempts-- > 0) {
        printf("\nUser: ");
        read_line(user, sizeof(user));
        printf("Password: ");
        read_line(pass, sizeof(pass));
        if (is_valid_worker(user, pass)) return 1;
        printf("Login salah. Sisa percobaan: %d\n", attempts);
    }
    return 0;
}

void print_main_menu() {
    printf("\n--- Menu Utama ---\n");
    printf("1: Pendaftaran\n");
    printf("2: Tindakan (02/04)\n");
    printf("3: List / Search\n");
    printf("0: Keluar\n");
}

int main() {
    char buf[32];

    printf("===== SISTEM PELAYANAN MEDICARE X =====\n\n");
    printf("Login Pegawai Medicare X\n");
    if (!login()) { printf("Login gagal. Program keluar.\n"); return 0; }
    printf("Login berhasil. Lanjut ke sistem.\n");

    while (1) {
        print_main_menu();
        printf("Pilih (1 / 2 / 3 / 0): ");
        read_line(buf, sizeof(buf));
        int opt = atoi(buf);
        if (opt == 0) {
            printf("Selesai. Sampai jumpa ï¿½ semoga tetap sehat.\n");
            return 0;
        }
        switch (opt) {
            case 1: register_patient(); break;
            case 2: tindakan_menu(); break;
            case 3: {
                printf("1: Tampilkan semua\n2: Cari nama\nPilih: ");
                read_line(buf, sizeof(buf));
                int m = atoi(buf);
                if (m == 1) list_patients();
                else if (m == 2) search_name();
                else printf("Pilihan tidak valid.\n");
                break;
            }
            default: printf("Pilihan tidak valid.\n"); break;
        }
    }
    return 0;
}
